---
layout: default
title: Label Assignment in Object Detection
date: 2020-04-24 18:32 +0800
---

åœ¨æœ€åˆçš„Faster R-CNNåšæ³•ä¸­ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡æ¡†ä¸Žæ¡†ä¹‹é—´çš„IoUæ¥å†³å®šanchorçš„æ­£è´Ÿæ ‡ç­¾çš„ï¼Œä½†æ˜¯è¿™ç§ä½¿ç”¨IoUä¸€åˆ€ç çš„æ–¹å¼æ¥å†³å®šlabelæœªå…æœ‰äº›ç²—é²ï¼Œæ‰€ä»¥åŽç»­å‡ºçŽ°å„ç§èŠ±å¼çš„label assignmentï¼Œå°±æ‰“ç®—æ•´ç†ä¸€ä¸‹ï½ž

é¦–å…ˆè¯´è¯´Fast R-CNNä¸€ç±»ï¼Œé€šè¿‡è®¡ç®—anchorä¸ŽGTä¹‹é—´çš„IoUï¼ŒæŠŠIoU > fg_thres(0.7)ä½œä¸ºæ­£æ ·æœ¬ï¼ŒIoU < bg_thres(0.3)ä½œä¸ºè´Ÿæ ·æœ¬ï¼ŒIoUåœ¨bg_thres ~ fg_thres(0.3 ï½ž 0.7)ä¹‹é—´çš„è®¤ä¸ºæ˜¯ignoreæ ·æœ¬ï¼Œçœ‹èµ·æ¥è¿˜æŒºåˆç†ï½žä½†æ˜¯ä¸å…å­˜åœ¨å¦‚ä¸‹å‡ ç§é—®é¢˜ï¼š

- é—®é¢˜ä¸€ï¼šå¦‚æžœä¸€ä¸ªæ¡†åœ¨0.3ä»¥ä¸‹é‚£å®ƒå°±ä¸èƒ½è¢«å›žå½’åˆ°0.5ä»¥ä¸Šäº†å—ï¼Ÿå¦‚æžœå®ƒè¢«å›žå½’åˆ°äº†æˆ‘ä»¬è¿˜æŠŠå®ƒçœ‹ä½œè´Ÿæ ·æœ¬ï¼Œé‚£æ˜¯ä¸æ˜¯æŸç§ç¨‹åº¦ä¸Šåœ¨deteriorateæ¨¡åž‹çš„è¡¨çŽ°å‘¢ï¼Ÿ
- é—®é¢˜äºŒï¼šä¸ŽGT IoU0.9çš„æ¡† ä¸ŽGT IoU0.55çš„æ¡†ï¼Œåº”è¯¥éƒ½ç»™1å—ï¼Ÿä»–ä»¬å…¶å®žæ˜¯æœ‰å¥½åä¹‹åˆ†çš„ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨IoUä¸€åˆ€ç çš„çŽ¯å¢ƒä¸‹ï¼Œæ²¡æ³•ä½“çŽ°å‡ºæ¥è¿™ç§ä¼˜åŠ£ä¹‹åˆ†ã€‚
- é—®é¢˜ä¸‰ï¼šç”±äºŽæˆ‘ä»¬çš„anchorè®¾ç½®æ˜¯predefineçš„ï¼Œé‚£ä¹ˆå¯èƒ½æ— æ³•ä¿è¯æ¯ä¸€ä¸ªGTéƒ½å­˜åœ¨å¾ˆå¥½çš„anchorå’Œå®ƒåŒ¹é…ï¼Œè¿™æ ·å°±ä¼šé€ æˆä¸€ä¸ªé—®é¢˜ï¼šæ¯ä¸ªGTä¸Žä»–å‘¨å›´çš„anchorçš„IoUçš„é‡å åˆ†å¸ƒæ˜¯ä¸åŒçš„ï¼Œè¿™æ ·å¦‚æžœæˆ‘ä»¬ä¸€åˆ€åˆ‡å°±ä¼šå¯¼è‡´ä¸åŒGTæ ·æœ¬è¢«åˆ†é…åˆ°çš„anchorä¸å‡è¡¡ã€‚è™½ç„¶çŽ°åœ¨çš„å®žçŽ°é‡Œæˆ‘ä»¬ä¼šä¿è¯æ‰¾åˆ°å’ŒGTåŒ¹é…åº¦æœ€é«˜çš„anchorï¼ˆæ— è®ºå®ƒä¸Žè¯¥GTçš„IoUæ˜¯å¤šå°‘ï¼‰è®¾ä¸ºæ­£æ ·æœ¬ï¼Œä½†æ˜¯ä¾ç„¶æ²¡æœ‰ä»Žæœ¬è´¨ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ã€‚

å¯¹äºŽé—®é¢˜ä¸€ï¼Œæˆ‘ç›®å‰çœ‹åˆ°äº†ä¸¤ç¯‡æ–‡ç« å…¶å®žæƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯HAMBoxï¼Œä¸€ä¸ªæ˜¯Learning from noisy labels for one stage object detectionã€‚

### TopK

é¦–å…ˆè¯´ä¸€ä¸‹TopKå§ï¼Œæ˜¯æˆ‘åœ¨å®žä¹ çš„æ—¶å€™å­¦åˆ°çš„ä¸€ç§æ–¹æ³•ï¼Œæ®è¯´æ˜¯å½“å¹´fppæ‹¿å† å†›çš„æ—¶å€™åˆ†äº«çš„æ–¹æ³•ï¼Œå³åœ¨assign anchor labelçš„æ—¶å€™ï¼Œå¯¹äºŽæ¯ä¸ªGTï¼Œæˆ‘ä»¬éƒ½æ‰¾åˆ°topkçš„æ ·æœ¬æŠŠä»–ä»¬å½“æˆæ­£æ ·æœ¬ï¼Œè¿™æ ·åšçš„å¥½å¤„ä¹Ÿå¾ˆæ˜Žæ˜¾ï¼šå¯¹äºŽå°ç‰©ä½“GTï¼Œå¯èƒ½å’Œå®ƒåŒ¹é…çš„anchorå¾ˆå°‘ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æžœè¿˜æ ¹æ®IoUæ¥æ‰¾æ­£æ ·æœ¬çš„anchorï¼Œé‚£ä¹ˆå¯èƒ½æ‰“ç‰©ä½“è¢«åˆ†é…äº†å¾ˆå¤šanchoræ¥è®­ç»ƒï¼Œè€Œå°ç‰©ä½“è¢«assignåˆ°çš„anchoræ•°å°±æ¯”è¾ƒå°‘ï¼ˆçªç„¶å‘çŽ°å¯ä»¥ä»Ždata imbalanceçš„è§’åº¦æ¥çœ‹è¿™ä¸ªé—®é¢˜hhhï¼‰ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥çœ‹ä½œé€šè¿‡ä¸€ç§dynamicçš„æ–¹å¼æ¥åŠ¨æ€æ”¹å˜IoUé˜ˆå€¼æ¥åˆ’åˆ†æ­£è´Ÿæ ·æœ¬ï½žåŒæ—¶æˆ‘ä»¬ä¿è¯äº†ä¸åŒå¤§å°çš„ç‰©ä½“éƒ½èƒ½å¤Ÿå¾—åˆ°ä¸€å®šçš„anchorè¿›è¡Œè®­ç»ƒã€‚topkæ–¹æ³•å¯ä»¥çœ‹ä½œæ˜¯å¯¹é—®é¢˜ä¸€çš„è§£å†³æ–¹æ³•ã€‚

### Learning from Noisy Anchor

é‚£ä¹ˆé—®é¢˜äºŒè¯¥æ€Žä¹ˆåŠžå‘¢ï¼Ÿä¸€ä¸ªå¾ˆç›´è§‚çš„æƒ³æ³•ï¼šé‚£æˆ‘èƒ½ä¸èƒ½æ ¹æ®å›žå½’å‡ºæ¥çš„ç»“æžœæ¥åŠ¨æ€çš„å†³å®šæˆ‘çš„anchorçš„è´¨é‡å¥½åå‘¢ï¼Ÿå¦‚æžœæˆ‘èƒ½ç»™ä»–å›žå½’çš„å¾ˆå¥½ï¼Œé‚£è¿™ä¸ªanchorçš„ç¡®å¾ˆæ£’ï¼Œå¦‚æžœæˆ‘å›žå½’çš„ä¸æ˜¯å¾ˆè¡Œï¼Œé‚£å°±è®©è¿™ä¸ªanchorçˆ¬ã€‚Learning from noisy anchor for one stage object detectionå¹²çš„å°±æ˜¯è¿™ä¹ˆä¸€ä»¶äº‹æƒ…ï½žè¿™ç¯‡æ–‡ç« çš„å‡ºå‘ç‚¹å°±æ˜¯ä»Žé—®é¢˜ä¸€å‡ºå‘çš„ï¼Œä¸è¿‡æ˜¯ä»Žå¦å¤–ä¸€ä¸ªè§’åº¦æ¥æ€è€ƒé—®é¢˜ä¸€ï¼šå°±æ˜¯æˆ‘ä»¬çœ‹ä½œæ˜¯æ­£æ ·æœ¬çš„é‚£äº›anchorï¼Œæ˜¯ä¸æ˜¯éƒ½å¾ˆæ£’å‘¢ï¼Ÿæ˜¯ä¸æ˜¯ä¹Ÿæœ‰ä¸æ˜¯å¾ˆå¥½çš„æ ·æœ¬å˜žï¼Ÿé‚£ä¹ˆæ€Žä¹ˆå†³å®šä¸€ä¸ªanchoræ˜¯ä¸æ˜¯noisyçš„å‘¢ï¼Ÿä½œè€…æå‡ºäº†å¯ä»¥ä»Žå›žå½’åŽå’ŒGTçš„IoUä»¥åŠåˆ†ç±»çš„scoreæ¥çœ‹ï¼ŒäºŽæ˜¯ä¹Žï¼Œè¿™ä¸¤ä¸ªå€¼ä¹˜èµ·æ¥ï¼Œå°±ä½œä¸ºæˆ‘è¯„ä»·anchorè´¨é‡çš„è¯„åˆ¤æ ‡å‡†å•¦ï¼ˆæ–‡ä¸­å«åšcleanlinessï¼‰ï½žæ‰€ä»¥è¿™ä¸ªanchorçš„è´¨é‡æ€Žä¹ˆååº”åˆ°æˆ‘çš„ç½‘ç»œä¸­å‘¢ï¼Ÿé¦–å…ˆä½œè€…æŠŠå®ƒä½œä¸ºclsçš„labelæ”¾åˆ°äº†focal lossé‡Œé¢ï¼Œä¹Ÿå°±æ˜¯ä¸å†ç”¨0/1ä½œlabelï¼Œè€Œæ˜¯ä½¿ç”¨è¿™ä¸ªcleanlinessä½œä¸ºlabelï¼ŒåŒæ—¶å®ƒè¿˜å‚ä¸Žåˆ°regressionçš„éƒ¨åˆ†ï¼Œä½œä¸ºæƒé‡åŠ æƒå›žå½’ï¼Œä¹Ÿå°±æ˜¯å¥½çš„anchoræˆ‘ä»¬å°±å¤šå›žå½’ï¼Œnoisyçš„anchoræˆ‘ä»¬å°±å°‘å›žå½’ï½žæ‰€ä»¥è¯´è¿™ç¯‡æ–‡ç« å®žé™…ä¸Šæ˜¯ä»Žå­¦ä¹ çš„è¿‡ç¨‹ä¸­åŠ¨æ€çš„å†³å®šanchorçš„labelï¼Œæ ¹æ®ç½‘ç»œå­¦ä¹ çš„ç»“æžœæ¥å†³å®šè¿™ä¸ªanchoræ˜¯å¥½çš„è¿˜æ˜¯åçš„ã€‚æ„Ÿè§‰è¿˜æ˜¯æŒºåˆç†å“ˆï½ž

8âƒ£ï¸è¿‡ï¼Œè¿™ç¯‡æ–‡ç« å…¶å®žéƒ½æ˜¯æŠŠé‡ç‚¹æ”¾åœ¨äº†åˆšå¼€å§‹å°±positiveçš„anchorï¼Œè€Œnegativeçš„anchoræ°¸ä¸–ä¸å¯è¶…ç”Ÿï¼Œä¹Ÿå°±æ˜¯ä¾ç„¶æ²¡æ³•è§£å†³æˆ‘ä»¬é—®é¢˜ä¸€ä¸­æåˆ°çš„é—®é¢˜ã€‚

### HAMBox

æŽ¥ç€å°±å¯ä»¥è¯´ä¸€ä¸‹HAMBoxäº†ï½žè¿™ç¯‡æ–‡ç« æ˜¯åœ¨äººè„¸æ£€æµ‹ä¸Šåšçš„ï¼Œæ–‡ç« é‡Œè¯´åœ¨ä»–ä»¬çš„modelé‡Œï¼Œanchoræ˜¯æ²¡æœ‰ignoreåŒºé—´çš„ï¼Œä½ŽäºŽ0.35çš„å°±éƒ½æ˜¯è´Ÿæ ·æœ¬ï¼Œé«˜äºŽ0.35çš„å°±éƒ½æ˜¯æ­£æ ·æœ¬ï¼Œä¸è¿‡æˆ‘æ²¡æœ‰æ€Žä¹ˆè¯»è¿‡äººè„¸æ£€æµ‹çš„æ–‡ç« ï¼Œä¸çŸ¥é“è¿™ç§åšæ³•æ˜¯ä¸æ˜¯common practiceï¼Œä½†æ˜¯è¿™æ ·assignçš„è¯ï¼Œæˆ‘ä»¬ä¹‹å‰æåˆ°çš„é—®é¢˜ä¸€å°±æ›´åŠ æ˜¾è‘—ï¼Œå³ä¸€æ—¦æœ‰ä¸€ä¸ªanchorä½ŽäºŽ0.3çš„IoUï¼Œå®ƒå°±æ˜¯è´Ÿæ ·æœ¬ï¼Œæˆ‘åˆ†ç±»çš„æ—¶å€™å°±è¦æŠ‘åˆ¶å®ƒï¼Œè¿™æ ·å¯èƒ½ä¼šdeteriorateæ¨¡åž‹çš„åˆ†ç±»èƒ½åŠ›ã€‚

è€ŒHAMBoxå‘çŽ°ï¼Œæœ€ç»ˆå›žå½’å‡ºæ¥çš„IoUå¤§äºŽ0.5çš„æ£€æµ‹æ¡†é‡Œï¼Œæœ‰å¾ˆå¤§çš„æ¯”ä¾‹æ¥è‡ªäºŽè¿™äº›åˆšå¼€å§‹çš„anchorä¸ŽGTçš„IoUä½ŽäºŽ0.35çš„anchorã€‚é‚£å²‚ä¸æ˜¯é”™æ€äº†ä¸€å¤§æ‰¹anchorï¼Ÿæ‰€ä»¥HAMBoxæå‡ºäº†ä¸€ç§anchorè¡¥å¿çš„ç­–ç•¥ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼ŒåŠ¨æ€çš„ä¿®æ”¹é‚£äº›è¢«å›žå½’å¥½çš„æ ·æœ¬ã€‚æ‰€ä»¥HAMBoxä¸»è¦è§£å†³çš„å°±æ˜¯æˆ‘ä»¬è¯´çš„é—®é¢˜ä¸€çš„é—®é¢˜ï¼Œæˆ‘ä¼šåœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼ŒåŠ¨æ€çš„æŠŠé‚£äº›æœ¬èº«å’ŒGTé‡å åº¦ä¸é«˜ä½†æ˜¯æœ€åŽå›žå½’çš„å¥½çš„anchorè®¾ä¸ºæ­£æ ·æœ¬ã€‚å…·ä½“çš„åšæ³•å…¶å®žå’Œtopkæœ‰ç‚¹ç±»ä¼¼ï¼Œä½œè€…ä¼šåœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œå¯¹æ¯ä¸ªGTåŠ¨æ€çš„è¡¥å¿åˆ°kä¸ªanchorï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒHAMBoxä¸æ˜¯åƒtopké‚£æ ·ç›´æŽ¥æŠŠæ‰€æœ‰topkéƒ½çœ‹æˆæ­£æ ·æœ¬ï¼ˆä¸è¿‡topkå¥½åƒfppä¹Ÿæ²¡æœ‰å‘paperï¼Œå…·ä½“æ€Žä¹ˆåšçš„æˆ‘ä¹Ÿä¸çŸ¥é“ðŸ¤·â€â™‚ï¸ï¼‰ï¼Œè€Œæ˜¯æ ¹æ®å›žå½’çš„å¥½åæŠŠæŸäº›æ¨¡åž‹èƒ½å¤Ÿå›žå½’å‡ºæ¥çš„anchorè®¾ä¸ºæ­£æ ·æœ¬ã€‚å…¶å®žä½ å¯ä»¥çœ‹ä½œ HAMBoxçš„é‡ç‚¹åœ¨äºŽå¦‚ä½•å¤„ç†åˆšå¼€å§‹è¢«assignä¸ºè´Ÿçš„æ ·æœ¬ï¼Œè€ŒLearning from noisy anchorçœ‹ä½œå¦‚ä½•å¤„ç†åˆšå¼€å§‹è¢«assignä¸ºæ­£çš„æ ·æœ¬ï½ž

### ATSS

ATSSè™½ç„¶åŒæ ·åœ¨è§£å†³æ­£è´Ÿæ ‡ç­¾assignçš„é—®é¢˜ï¼Œä½†æ˜¯å…¥æ‰‹çš„è§’åº¦æ˜¯ä»Žanchor basedå’Œanchor freeçš„åŒºåˆ«å‡ºå‘ã€‚æ–‡ç« ä»ŽRetinaNetå’ŒFCOSå‡ºå‘ï¼ŒæŠŠFCOSä¸Šçš„ç»“æž„éƒ½åœ¨RetinaNetä¸ŠåŠ äº†ä¸€éï¼ŒåŒæ—¶å¯¹æ¯”äº†classificationå’Œregressionåˆ†æ”¯ä¸¤è€…çš„åŒºåˆ«ï¼Œæœ€åŽå‘çŽ°RetinaNetå’ŒFCOSçš„åŒºåˆ«åœ¨äºŽï¼šæ­£è´Ÿæ ·æœ¬Assignçš„è§„åˆ™å¯¼è‡´äº†æœ€ç»ˆç‚¹æ•°ä¸Šçš„å·®è·ã€‚ä¹Ÿå°±æ˜¯label assignmentçš„é—®é¢˜ã€‚ï¼ˆå½“ç„¶ATSSåœ¨ä¸€æ­¥ä¸€æ­¥åˆ†æžè¿™ä¸¤è€…åŒºåˆ«çš„è¿‡ç¨‹ä¹Ÿæ˜¯è¿™ç¯‡æ–‡ç« å¾ˆæ£’çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹åˆ°æ€è·¯éžå¸¸æ¸…æ™°çš„ï¼Œä¸æ„§æ˜¯shifengå¤§ä½¬orzï¼‰è‡³äºŽATSSçš„åšæ³•å…¶å®žæ˜¯ä»Žç»Ÿè®¡æ„ä¹‰ä¸Šæ¥æ€è€ƒæ­£è´Ÿæ ·æœ¬çš„å®šä¹‰ã€‚ç›´è§‚çš„ç†è§£å°±æ˜¯ï¼Œå¦‚æžœä½ æŠŠæ¯ä¸ªGTå‘¨å›´çš„anchorä¸Žå®ƒçš„IoUç»Ÿè®¡ä¸€ä¸‹ï¼Œå…¶å®žæ˜¯å¯ä»¥å½¢æˆä¸€ä¸ªåˆ†å¸ƒçš„ï¼Œé‚£ä¹ˆæˆ‘é€šè¿‡å–è¿™ä¸ªåˆ†å¸ƒä¸Šçš„æŸä¸ªåˆ†ä½æ•°æ¥å†³å®šæ¯ä¸ªGTçš„IoU Threså²‚ä¸æ˜¯å¾ˆåˆç†ï¼Ÿå…¶å®žå¦‚æžœå†æƒ³æƒ³ä½ å¯ä»¥å‘çŽ°ATSSä¹Ÿå’Œtopkæœ‰ç€å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œä»–ä»¬éƒ½æ˜¯ä»Žæ¯ä¸ªGTå‡ºå‘ï¼ŒåŽ»argmax GTå‘¨å›´çš„çš„anchorï¼Œè€Œä¸æ˜¯ argmax proposalå‘¨å›´çš„GTã€‚å¯èƒ½ä»ŽGTå‡ºå‘æ¥å†³å®šanchorçš„æ­£è´Ÿæ‰æ˜¯æ›´ä¸ºåˆç†çš„æ–¹å¼ï¼Ÿ

å†™åˆ°è¿™é‡Œå·®ä¸å¤šå°±ç»“æŸäº†ï¼Œæœ€åŽå›žè¿‡å¤´æ¥çœ‹ï¼Œç›®å‰çš„å‡ ç§è§£å†³label assignmentçš„æ–¹å¼å¯ä»¥å½’çº³ä¸ºä¸¤ç§ï¼š

1. åŠ¨æ€çš„æ ¹æ®å›žå½’åŽçš„ç»“æžœå†³å®šanchorçš„å¥½å
2. ä»Žæ¯ä¸ªGTå‡ºå‘assign labelï¼Œè€Œä¸æ˜¯ä»Žanchorå‡ºå‘



[1] HAMBox: Delving into Online High-quality Anchors Mining for Detecting Outer Faces, Yang Liu, et.al

[2] Bridging the Gap Between Anchor-based and Anchor-free Detection via Adaptive Training Sample Selection, Shifeng Zhang, et.al

[3] Learning from Noisy Anchors for One-stage Object Detection, Hengduo Li, et.al

